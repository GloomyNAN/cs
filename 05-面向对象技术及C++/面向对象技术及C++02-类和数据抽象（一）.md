---
title: 面向对象技术及C++02-类和数据抽象（一）
date: 2020-07-16 21:36:39
---

## 2.1 引言

### 什么是对象(object)

世界中的任何事物都是对象。对象由状态和行为封装(encapsulation)组合而成。

![什么是对象](./面向对象技术及C++02-类和数据抽象（一）/什么是对象.png)

### 对象的特点

1. 对象的状态只能被自己的行为所改变。对象之间通过消息(message)相互作用，一个对象可以向另一个对象发送消息，以达到相互联系的目的。
2. 面向对象程序设计(OOP)用软件方法模拟现实世界中的各种对象。在C++语言中，将具有相同属性和行为的对象抽象(abstract)为类(class)。
3. C++语言还利用继承(inheritance)的关系---新建类通过先用类派生建立。一个类中的一个行为可接收来自不同对象的不同类型的消息，并做出不同的反应，这就是面向对象程序设计中的**多态性**(polymorphism)。

### 面向对象程序设计的优点

1. 因为直接模拟了现实世界中的对象，因此这种设计方法更自然、更直观。 
2. 对象之间通过消息通信，因此可实现对象的自包含和相对独立性。 
3. 由于对象中封装了数据(状态)和函数(行为)，因此能实现信息隐藏(data hiding)，对另一个对象来说，它的实现细节完全隐藏。 

### 面向对象程序设计的特点总结

- 继承性
- 抽象性
- 封装性
- 多态性

### 面向对象程序设计的实现

通过类(class)这种自定义类型(user defined type)描述一组对象所共有的属性(数据成员 data member)和行为方法(成员函数 member function)。这实现了面向对象程序设计的**抽象性和封装性**。

通过类的导出（derive）机制建立新的类。这实现了面向对象程序设计的**继承性**。

通过函数名重载(function overloading)、运算符重载(operator overloading)和虚函数(virtual function)机制实现静态多态性和动态多态性。这实现了面向对象设计的**多态性**。

## 2.2 结构的定义

在C语言中，使用struct定义结构类型。struct和类型标志(tag)作为一个自定义的类型名使用。例： 

```c++
struct Time  
{ 
    int hour;
    int minute;    
    int second;  
}; 
```
定义了一个类型名称为struct Time的新类型。

在C++语言中，使用struct定义结构类型，类型标志位一个自定义的类型名使用。这里类型名称为Time。

在C语言中，结构直播暗含数据成员(data member)，而在C++语言中，除了包含数据成员之外，还允许包含成员函数(member function)_ 

## 2.3 访问结构的成员

访问结构成员(无论是数据成员，还是成员函数)均使用两个运算符：          
`.      -> `

这两个运算符都是双目(binary)运算符。 

`.`的左操作数是结构对象的名称，右操作数是结构中的某一个成员的名称。 <br/>
`->`的左操作数是指向结构对象指针的名称，右操作数也是结构中的某一个成员的名称。

### 程序例子

```c++
struct Time 
{  
    int hour;    
    int minute;    
    int second; 
}; 
Time t; 
Time* pt; 
…… 
cout << t.hour; 
pt = &t; 
cout << pt->minute;
```

## 2.4 用结构实现用户定义的类型

问题：定义一个表示时间概念的类型Time 。

```c++
//*****************************************
// 建立一个结构、设置其成员和打印该结构
//******************************************
#include <iostream>
using namespace std;
struct Time {  // 结构的定义
  int hour;    // 0 - 23
  int minute;  // 0 - 59
  int second;  // 0 - 59
};
void printMilitary(const Time&); // 函数原型
void printStandard(const Time&); // 函数原型

// 以军用格式打印时间
void printMilitary(const Time& t)
{
   cout << ( t.hour < 10 ? "0" : "" ) 
        << t.hour << ":"
        << ( t.minute < 10 ? "0" : "" ) 
        << t.minute << ":"
        << ( t.second < 10 ? "0" : "" ) 
        << t.second;
}

// 以标准格式打印时间
void printStandard(const Time& t)
{
   cout << (( t.hour == 0 || t.hour == 12 ) 
            ? 12 : t.hour%12 )
        << ":" << ( t.minute < 10 
            ? "0" : "" ) << t.minute 
        << ":" << ( t.second < 10 
            ? "0" : "" ) << t.second
        << ( t.hour < 12 ? "AM" : "PM" );
}

int main()
{  Time dinnerTime;  // 新类型Time的变量
   
   // 给成员设置合法的值
   dinnerTime.hour=18;
   dinnerTime.minute=30;
   dinnerTime.second=0;
   
   cout << "Dinner will be held at ";
   printMilitary(dinnerTime);
   cout << " military time, \nwhich is ";
   printStandard(dinnerTime);
   cout << " standard time. " << endl;

   // 给成员设置不合法的值
   dinnerTime.hour=29;
   dinnerTime.minute=73;
   dinnerTime.second=103;
   
   cout << "\nTime with invalid values: ";
   printMilitary(dinnerTime);
   cout << endl;
       
   return 0;
}
```

### 使用结构定义Time类型的缺陷

定义结构对象（变量）时如果没有给出初始值，则对象处于不稳定状态（其数据成员的值可能是随机值），而这时使用该对象会产生语义错误。

对结构对象的数据成员复制由于没有收到控制，因此也可能被赋予不合理的值而导致语义错误。

因使用结构类型的程序代码直接操作了结构类型中的数据成员，则当改变结构的实现方法（如用一个整型数表示时间[从0:0:0]到现在的时间秒数）时，所有使用改机构的程序代码也需要进行对应的修改，以适应新的结构定义。

使用结构的程序代码以结构中的单个数据成员作为基本使用单位，不能对结构进行整体操作。如要比较两个时间的先后顺序，只能通过比较各个数据成员才能完成。

### 解决缺陷的方法

使用类定义方法替代结构定义方法可以解决

使用结构定义时产生的一些缺陷。

## 2.5 用类实现抽象数据类型

类用来模拟具有属性（数据成员）和行为（成员函数）的对象，用关键字class开始定义类这种自定义的数据类型(user-defined data type)。 

### 程序例子 类Time

```c++
#include <iostream>
using namespace std;
class Time {  
public: Time();               // 缺省构造函数
   void setTime(int,int,int); // 设置时、分、秒
   void printMilitary();      // 打印军用格式时间
   void printStandard();      // 打印标准格式时间
private:
    int hour;    // 0 - 23
    int minute;  // 0 - 59
    int second;  // 0 - 59
};


// 类Time的构造函数把每一个数据成员初始化为0，
// 从而保证类Time的所有对象都有稳定的初始状态。
Time::Time() { hour=minute=second=0; }

// 用军用格式的时间为类Time的数据成员设置新的值。
// 检查数据的合法性。把不合法的值设置为0。
void Time::setTime( int h, int m, int s )
{
    hour = ( h >= 0 && h < 24 ) ? h : 0;
    minute = ( m >= 0 && m < 60 ) ? m : 0;
    second = ( s >= 0 && s < 60 ) ? s : 0;
}

// 打印出军用格式时间
void Time::printMilitary()
{
   cout << ( hour < 10 ? "0" : "" ) 
        << hour << ":"
        << ( minute < 10 ? "0" : "" ) 
        << minute<< ":"
        << ( second < 10 ? "0" : "" ) 
        << second;
}


// 打印出标准格式时间
void Time::printStandard()
{
   cout << ( ( hour == 0 || hour == 12 ) 
             ? 12 : hour % 12 )
         << ":" << ( minute < 10 
             ? "0" : "" ) << minute
         << ":" << ( second < 10 
             ? "0" : "" ) << second
         << ( hour < 12 ? " AM" : " PM" );
}

// 测试简单的类Time
int main()
{ Time t; // 建立类Time的实例对象t
  cout << "The initial military time is ";
  t.printMilitary();
  cout << "\nThe initial standard time is ";
  t.printStandard();
  t.setTime( 13, 27, 6 );
  cout << "\n\nMilitary time after setTime is ";
  t.printMilitary();
  cout << "\nStandard time after setTime is ";
  t.printStandard();


 t.setTime( 99, 99, 99 ); // 试图设置非法值
 cout << "\n\nAfter attempting invalid settings:"
      << "\nMilitary time: ";
 t.printMilitary();
 cout << "\nStandard time: ";
 t.printStandard();
 cout << endl;
     
 return 0;
}
```

### 用类实现抽象数据类型

#### 类的访问属性

- public: 使用对象的任何函数均可访问。一般对应于类的使用界面（接口）。 
- private: 只有本类中成员函数才能访问，不能被任何非类成员函数访问。一般对应于类的内部表示，对类的使用者（也称客户client）隐藏。

#### 构造函数

构造函数(constructor)是一种与类同名的具有public访问属性的一种特殊函数，专门用于初始化类的对象。在建立类对象时，构造函数被自动隐式地调用。 

#### 作用域约束符

- 在类说明之后定义成员函数时，成员函数名前必须加上类名作用域(class scope)约束符::，表示该函数不是一个全局函数，而是属于类作用范围的一个成员函数。
- 类名作用域约束符::是必须的，否则就无法区分一个函数是全局函数，是这个类的成员函数，还是另一个类的成员函数。 

#### 使用类说明对象

定义好的类可用于说明对象。 

例： 

```c++
Time sunset,      
arrayofTime[10],       
*pTime,       
&dinnertime=sunset; 
```

分别定义了对象sunset，数组arrayofTime，指针pTime和引用dinnertime 。

#### 使用类的好处

1. 类的使用者不依赖于具体实现，也不需要了解实现细节。 
2. 使用构造函数保证对象具有稳定性，不至于出现具有非法时间值的一个Time对象。 
3. 由于构造函数是在建立对象的时候自动被调用的，所以一开始对象就是稳定的。 
4. 通过成员函数SetTime修改时间，该函数也保持了对象的稳定性。 
5. 由于hour等是private成员，因此类的使用者不可能直接对它们进行修改，也不可能破坏对象的稳定性。

### 使用类的注意点

- 数据成员不能在说明处赋值。因为说明类只是建立一种新的数据类型，而不是定义一个对象，因此对象还不存在，也就没有对应的存贮空间，更谈不上对一个对象赋值了。 
- 类的初始化(initialization)在类的构造函数中完成。构造函数在建立对象的时候自动被调用。 
- 类的使用者只能访问类的接口(interface)（public 成员函数），不能访问类的实现(implementation)（private数据成员或成员函数）。 
- 类的销毁(destroy)在类的析构函数(destructor)中完成。析构函数在销毁对象的时候自动被调用。析构函数是具有public访问属性的成员函数，函数名为符号~加上类型名。通常执行一些对象销毁前的清理(cleanup)工作。在类Time中，由于无需做清理工作，因此没有定义析构函数。 
- 类在说明后，还必须进行实现(implement)。实现就是定义每一个类的成员函数。定义成员函数可以在类说明时完成，也可在类说明后再给出它们的函数定义。
- 实现时，小的函数定义可直接在类说明中给出定义。大部分成员函数的函数定义应在类说明之后再给出。 
- 在类说明后再给出成员函数的定义，有助于分离类的接口和类的实现，满足面向对象程序设计中数据抽象的基本要求。 
- 在Time类中，两个print成员函数没有参数，表示它们操作的数据就是本对象中的数据成员。可以这样理解：这两个函数的操作对象就是函数名之前点运算符 . 左边的对象。 

## 2.6 类的作用域和访问类的成员

## 2.7 接口和实现的分离

## 2.8 控制对成员的访问 

## 2.9 访问函数和工具函数

## 2.10 初始化类的对象：构造函数

## 2.11 在构造函数中使用默认参数 

## 2.12 析构函数的使用

## 2.13 调用析构函数和构造函数的时机 

## 2.14 数据成员和成员函数的使用

## 2.15 微妙的陷阱

## 2.16 逐个成员拷贝的默认赋值方式

## 2.17 软件的可重用性


![通用计算机分类](./面向对象技术及C++02-类和数据抽象（一）/什么是对象.png)
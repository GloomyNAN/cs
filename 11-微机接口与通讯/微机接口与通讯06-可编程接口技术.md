---
title: 微机接口与通讯06-可编程接口技术
date: 2020-04-25 16:56:03
---


# 一、可编程计数器8253

在计算机应用中，常常要对外设的某些信号进行计数，希望计算机既能控制计数的过程又能读取计数的结果，进而作为控制或管理的决策依据。因此计数电路就成为计算机接口中一种常见类型，如果被计数的信号有准确的固定周期，就形成了定时器。因此定时器和计数器的本质都是计数器。

**8253是常用的可编程定时计数接口芯片。**

## 1.1 8253／8254外部特点与功能

![8253](./微机接口与通讯06-可编程接口技术/8253.png)

### 8253的主要特点

- 有3个独立的16位计数器
- 每个计数器都可以按照二进制或BCD码进行计数
- 每个计数器的计数速率可高达2MHz（8254-2计数频率可达到10MHz）
- 每个计数器有6种工作方式，可由程序设置和改变
- 所有的输入输出引脚电平都与TTL电平兼容

## 1.2 8253内部结构与工作原理

![8253内部结构与工作原理1](./微机接口与通讯06-可编程接口技术/8253内部结构与工作原理1.png)
![8253内部结构与工作原理2](./微机接口与通讯06-可编程接口技术/8253内部结构与工作原理2.png)

每个计数端口有三根线与外界联系

- CLK：计数器脉冲输入
- GATE：门控信号
- OUT：计数器输出

![8253内部结构与工作原理3](./微机接口与通讯06-可编程接口技术/8253内部结构与工作原理3.png)

## 1.3 8253的控制字

8253只有一个控制字，8253的一个方式控制字只决定一个计数通道的工作模式。8253的控制字格式共分为4部分，通道选择、计数器读/写方式、工作方式和计数码的选择。

![8253的控制字](./微机接口与通讯06-可编程接口技术/8253的控制字.png)

## 1.4 8253的工作方式

### 方式0—计完最后一个数时中断

- 当控制字CW（Control Word）写入控制字寄存器，则使OUT输出端变低，此时计数器没有赋予初值，也没开始计数。
- 要开始计数，GATE信号必须为高电平，并在写入计数初值后，通道开始计数，在计数过程中 OUT线一直维持为低，直到计数到“0”时。OUT输出变高。

### 方式1—可编程序的单拍脉冲

当CPU写控制字之后，输出将保持为高（若原为低，则由低变高）。当CPU写完计数值后，计数器并不开始计数，直到外部门控脉冲GATE启动之后的下一个输入CLK脉冲的下降沿开始计数，输出OUT变低。因整个计数过程中，OUT都维持为低，直到计数到0，输出变为高，因此，输出为一个单拍脉冲。若外部再次触发启动，则可以再产生一个单拍脉冲。
		
### 方式2—速率发生器

当CPU输出控制字后，输出将为高。在写入计数值后，计数器将立即自动对输入时钟CLK计数。在计数过程中输出始终保持为高，直至计数器减到1时，输出将变低，经过一个CLK周期，输出恢复为高，且计数器开始重新计数。

### 方式3—方波速率发生器

方式3和方式2的输出都是周期性的，它们的主要区别是，方式3在计数过程中输出有一半时间为高，另一半时间为低。

### 方式4—软件触发选通

当写入控制字后，输出为高（原为高则保持为高，原为低则变为高）。当写入计数值后立即开始计数（相当于软件启动），当计数到0后，输出变低，经过一个输入时钟周期，输出又变高，计数器停止计数。这种方式计数也是一次性的，只有在输入新的计数值后，才能开始新的计数。

### 方式5—硬件触发选通

设置了控制字后，输出为高。在设置了计数值后，计数器并不立即开始计数，而是由门控脉冲的上升沿触发启动。当计数到0时，输出变低，经过一个CLK脉冲，输出恢复为高，停止计数。要等到下次门控脉冲的触发才能再计数。		

### 8253的工作方式小结
  
8253的六种工作方式可归为两类，一个是充当频率发生器，另一类主要是作计数器来使用。下面我们就从这个角度来讨论总结OUT和GATE门的作用。

- 与频率发生器有关的工作方式——8253有两种方式与频率发生器有关，即方式2和发生3。
  - 对OUT端，方式2提供给用户的是负脉冲，方式3提供给用户的是方波。
  - 这两种方式下，GATE信号要始终保持为高
- 与计数器有关的工作方式——对于计数器类，有方式0、1和方式4、5。启动计数器的方式有两种。
  - 一种是CPU把时间常数写入相应通道后，计数器就开始工作，我们可以称之为软件启动方式，在这种启动方式下，GATE要始终保持为高电平，所以方式0和方式4可以称为软件启动方式。
  - 另一种是硬件启动计数器，即CPU把时间常数写入计数器后，即使GATE为高电平，计数器并不工作。只有GATE发生跳变，其上升沿启动计数器工作。所以方式1和方式5就可以称为硬件启动方式。

计数器溢出时，OUT有两种输出形式，要么是电平，要么是负脉冲。前者有方式0方式1，后者有方式4和方式5。

## 1.5 8253应用举例

### 例1：现有一个高精密晶体振荡电路，输出信号是脉冲波，频率为1MHz。要求利用8253做一个秒信号发生器，其输出接一发光二极管，以0.5秒点亮，0.5秒熄灭的方式闪烁指示。设8253的通道地址为80H～86H（偶地址）。

### 解：

#### 1. 时间常数计算

这个例子要求用8253作一个分频电路，而且其输出应该是方波，否则发光二极管不可能等间隔闪烁指示。频率为1MHz信号的周期为1微妙，而1Hz信号的周期为1秒，所以分频系数N可按下式进行计算：

$N=\frac{1s}{1us}=\frac{1000000us}{1us}=1000000$

由于8253一个通道最大的计数值是65536，所以对于N＝1000000这样的大数，一个通道是不可能完成上述分频要求的。由于

$N = 1000000 = 1000 \times 1000 = N_1 \times N _2$

**即取两个计数器，采用级联方式。**

#### 2. 电路

![电路](./微机接口与通讯06-可编程接口技术/电路.png)

#### 3. 工作方式选择

由于通道1要输出方波信号推动发光二极管，所以通道1应选工作方式3。对于通道0，只要能起分频作用就行，对输出波形不做要求，所以方式2和方式3都可以选用。   这样对于通道0，我们取工作方式2，BCD计数；对于通道1，我们取工作方式3，二进制计数（当然也可选BCD计数）

#### 4. 程序

```
mov al,00110101b ；通道0控制字
out 86h,al
mov al,00 ；通道0初始计数值
out 80h,al
mov al,10h
out 80h,al
mov al,01110110b ；通道1控制字
out 86h,al
mov al,0e8h ；通道1初始计数值，3E8H=1000BCD
out 82h,al
mov al,03h
out 82h,al
```

# 二、并行通信接口8255A

## 2.1 8255A内部结构与引脚定义

8255A是一种通用的可编程并行I／O接口芯片，广泛用于几乎所有系列的微型机系统中，如8086、MCS51、Z80CPU系统等。8255A具有3个带锁存或缓冲的数据端口，可与外设并行进行数据交换。用户可用程序来选择多种操作方式，通用性强。使用灵活，可为CPU与外设之间提供并行输入／输出通道。

![8255A芯片引脚](./微机接口与通讯06-可编程接口技术/8255A芯片引脚.png)

### 2.1.1 与外设连接的管脚

8255A有三个数据端口，每个端口是8位，由此可推算与外设相连接的管脚共有24位。其中A口有PA7—PA0八个I/O引脚，B口有PB7—PB0八个I/O引脚，C口有PC7—PC0八个I/O引脚。特别地对于PC7—PC0，其中可有若干根复用线可用于“联络”信号或状态信号，其具体定义与端口的工作方式有关。

![与外设连接的管脚](./微机接口与通讯06-可编程接口技术/与外设连接的管脚.png)

### 2.1.2 与CPU连接的管脚

包括数据线D7—D0，读写控制线和复位线RESET，以及和CPU地址线相连接的片选信号、端口地址控制线A0和A1

![与CPU连接的管脚](./微机接口与通讯06-可编程接口技术/与CPU连接的管脚.png)

![8255A内部结构](./微机接口与通讯06-可编程接口技术/8255A内部结构.png)

## 2.2 8255A的工作方式机器初始化设置

8255A有三种工作方式，他们是：

- 方式0：基本输入/输出方式
- 方式1：选通输入/输出方式
- 方式2：双向传送方式

### 方式控制字

这是一个八位的控制字，代表的信息非常丰富。上面提到8255A内部的3个端口分为A、B两组，因此方式控制字也就相应地分成两个部分，分别控制A组和B组，其格式如下:

![方式控制字1](./微机接口与通讯06-可编程接口技术/方式控制字1.png)

### C口置“1”／清“0”控制字

- 置“1”又称为置位操作
- 清“0”称为复位操作  

![方式控制字2](./微机接口与通讯06-可编程接口技术/方式控制字2.png)

## 2.3 8255A各工作方式的功能特点说明

### 方式0--基本输入／输出方式。

- 端口A和端口B可以通过方式选择控制字规定为输入口或者输出口；
- 端口C分为高4位(PC7～PC4) 和低4位(PC3～PC0) 两个4位端口，这两个4位端口也可由方式选择控制字分别规定为输入口或输出口。
- 这四个并行口共可构成16种不同的使用组态。
- 利用8255A的方式0进行数据传输时，由于没有规定专门的应答信号，所以这种方式常用于与简单外设之间的数据传送，如向LED显示器的输出，从二进制开关装置的输入等。

### 方式1--选通输入输出方式。

端口A或端口B仍作为数据的输入/输出，但同时规定端口C的某些位作为控制或状态信息，用作一个或两个选通端口

#### 每一个端口包含有：

- 8位的数据端口
- 3条控制线（是固定指定的，不能用程序改变）
- 提供中断逻辑

#### 任一个端口都可作为输入或输出

- 若只有一个端口工作于方式1，余下的13位，可以工作在方式0（由控制字决定）。
- 若两个端口都工作于方式1，端口C还留下两位，这两位可以由程序指定作为输入或输出，也具有置位/复位功能。

### 方式2—双向输入输出方式，使外设在单一的8位总线上，既能发送，也能接收数据。

- 工作时可用程序查询方式，也可工作于中断方式。
- 方式2只用于端口A。
- 一个8位的双向总线端口（端口A）和一个5位控制端口（端口C）。
- 输入和输出是锁存的。
- 5位控制端口是用作端口A的控制和状态信息。	

## 2.4 8255A应用举例

### 2.4.1 与打印机接口 

例：在某一8086系统中接有一个打印机，8255A作为输出接口。工作在方式0，将缓冲区BUFF内的400H个字节的ACK码送打印机打印。

![与打印机接口1](./微机接口与通讯06-可编程接口技术/与打印机接口1.png)
![与打印机接口2](./微机接口与通讯06-可编程接口技术/与打印机接口2.png)

#### 打印机具体工作过程如下：

1. 数据线D7—D0出现有效数据；
2. STB有效，通知打印机，接口给打印机一个数据，数据从数据线进入打印机；
3. BUSY有效，告诉接口，打印机正在打印数据。打印完毕，BUSY变为无效，表示打印结束。 

# 三、串行通信接口8251

# 四、可编程中断控制器8259A

# 五、DMA控制器8237A

![8253内部结构与工作原理1](./微机接口与通讯06-可编程接口技术/8253内部结构与工作原理1.png)